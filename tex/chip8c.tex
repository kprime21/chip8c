\documentclass{article}
\title{\vspace{-7em} Chip8 Emulator in C}
\author{Kirjan Kohuladas/kprime21}
\date{}

\begin{document}
\maketitle


\section*{Overview}
Compact Hexadecimal Interpretive Programming â€“ 8-bit 
\subsection*{Components}
\begin{itemize}
	\item Memory - 4kB ram (4096 bytes - 4096 address lines each line is 1 byte)
	\item Display - 64 x 32 pixels 
	\item Registers
		\begin{itemize}
			\item Program Counter (16 bits)
			\item Index Register (16 bits) 
			\item Stack - call subroutines and functions (16 bits)
			\item Delay timer - decremented at 60Hz (8 bits)
			\item Sound timer - decremented at 60Hz (8 bits)
			\item 15 General purpose registers - V0 - VF (8 bits)
		\end{itemize}
\end{itemize}
\subsection*{Memory}
\begin{itemize}
	\item all memory is RAM, 4096 bytes. 
		\begin{itemize}
			\item 4096 addressable lines
			\item 12 bits needed
			\item each addressable line represents an addresss of 1 byte.
		\end{itemize}
	\item interpreter located 0x000-0x1FF (not in our case)
	\item program located 0x200 - 0x...
	\item font located before program 0x000-0x1FF (popular area - 0x050 - 0x09F)
\end{itemize}
\subsection*{Font}
\begin{itemize}
	\item font character should be 4px x 5px
	\item first byte is the character (draw vertically in nvim to see)
	\item stored in memory, index register set to specific font in memory to draw it
\end{itemize}
\subsection*{Display}
\begin{itemize}
	\item 60Hz - 60 times per second. Run 8 instructions then update frames. This way we have ~500Hz for the CPU cycles.
	\item sprite consists of 8 bits
	\item sprites are between 1 and 15 bytes tall
	\item 0 bits are transparent and 1 bits flip pixel locations
\end{itemize}
\subsection*{Stack}
\begin{itemize}
	\item stack(LiFo) to call and return from subroutines
	\item 16 bit addresses (12 bits useful) are saved here
\end{itemize}
\subsection*{Timers}
\begin{itemize}
	\item two timer registers - the delay timer and sound timer
	\item one byte in size and if above 0, decremented by 1 60 times per second (60Hz)
	\item sound timer beeps as long as it's above 0
\end{itemize}
\subsection*{Keypad}
\begin{itemize}
	\item 123C
	\item 456D
	\item 789E
	\item A0BF
\end{itemize}
\subsection*{Fetch/decode/excute loop}
\begin{itemize}
	\item fetch the instruction from memory at current PC (program counter)
	\item decode the instruction to find what emulator should do
	\item execute instruction and do what it tells you
	\item this loop's speed has to be set so that it does not run too fast (700Hz)
	\item fetch: read instruction in PC, two successive bytes and combine into one 16 bit instruction, increment PC by 2
	\item decode: switch statement checking first half of instruction 
	\item nibbles after first used for decoding, extract these before decoding from opcode
	\begin{itemize}
		\item X - second nibble
		\item Y - third nibble
		\item N - fourth nibble
		\item NN - third and fourth nibble - 8 bit immd number
		\item NNN - second, third and fourth nibble - 12 bit immd address 
	\end{itemize}
	\item execute: do what each instruction should do in each case of the switch
\end{itemize}
\subsection*{Opcodes}
\begin{enumerate}
	\item 0nnn - ignored by modern interpreters.
	\item 00E0 - CLS, clear the display.
	\item 00EE - RET, return from subroutine.
	\item 1nnn - JP addr, program counter set to nnn.
	\item 2nnn - CALL addr, increment stack pointer then place current PC on top of stack, then set PC to nnn.
	\item 3xkk - SE Vx byte, skip next instruction if Vx == kk, PC+=2.
	\item 4xkk - SNE Vx byte, skip next instruction if Vx != kk, PC+=2.
	\item 5xy0 - SE Vx, Vy, skip next instruction if Vx == Vy, PC+=2.
	\item 6xkk - LD Vx, byte - load kk into Vx.
	\item 7xkk - ADD Vx, byte - add value kk to register Vx, store result in Vx.
	\item 8xy0 - LD Vx, Vy - store value of register Vy in register Vx.
	\item 8xy1 - OR Vx, Vy - bitwise OR then store in Vx.
	\item 8xy2 - AND Vx, Vy - bitwise AND then store in Vx.
	\item 8xy3 - XOR Vx, Vy - bitwise XOR and then store in Vx.
	\item 8xy4 - ADD Vx, Vy - add Vx, Vy, result greater than 255 sets VF flag, only lowest 8 bits stored in Vx.
	\item 8xy5 - SUB Vx, Vy - Vx > Vy, Vf set to 1, otherwise 0. Subtract Vy from Vx and store in Vx.
	\item 8xy6 - SHR Vx (, Vy) - LSB of Vx is 1, set Vf to 1. Otherwise 0. Vx divided by 2.
	\item 8xy7 - SUBN Vx, Vy - Vy > Vx, Vf set to 1, otherwise 0. Subtract Vx from Vy and store in Vx. 
	\item 8xyE - SHL Vx (, Vy) - MSB of Vx is 1, set Vf to 1. Otherwise 0. Vx multiplied by 2.
	\item 9xy0 - SNE Vx, Vy - Vx and Vy compared, if not equal, PC+=2.
	\item Annn - LD I, addr - Index register is set to addr.
	\item Bnnn - JP V0, addr - Program Counter is set to nnn+V0.
	\item Cxkk - RND Vx, byte - Generate random number AND with kk, store in Vx.
	\item Dxyn - DRW Vx, Vy, nibble - Read n bytes from memory staring at address stored in Index. Bytes are displayed as sprites on screen at coord(Vx,Vy). Sprites are XOR'd onto screen, any overlapping part of sprite will be wrapped around screen. If sprite collides with another sprite then set Vf to 1.
	\item Ex9E - SKP Vx - Skip next instruction if key with value Vx is pressed, PC+=2.
	\item ExA1 - SKNP Vx - Skip next instruction if key with value Vx is not pressed, PC+=2.
	\item Fx07 - LD Vx, DT - Set the value of Vx to value of delay timer.
	\item Fx0A - LD Vx, k - Execution stops until key is pressed, store value of key in Vx.
	\item Fx15 - LD DT, Vx - Set the value of delay timer to value of Vx.
	\item Fx18 - LD ST, Vx - Set the value of sound timer to value of Vx.
	\item Fx1E - ADD I, Vx - Value of Index register and Vx added and stored in Index register.
	\item Fx29 - LD F, Vx - Index register is set equal to the location for hexadecimal sprite corresponding to value in Vx.
	\item Fx33 - LD B, Vx - Store BCD(Vx) in Index register, Index+1, Index+2.
	\item Fx55 - LD [I], Vx - Store registers V0 through Vx in memory starting at location in Index register.
	\item Fx65 - LD Vx, [I] - Read values from memory and store them from V0 through Vx.
\end{enumerate}

\section*{File Structure}
\begin{itemize}
	\item cpu.c - Contains the registers for the Chip8 emulator, the memory that the program is read into and the font that is read at the start
	\item cpu.h - Contains the structure for the CPU, RAM, keyboard and graphics array
	\item graphics.c - Contains the display graphics for the Chip8 emulator using SDL2
	\item graphics.h - Contains the graphics functions start, draw and stop
	\item main.c - Driver program that will read in the rom and start the CPU and graphics
	\item chip8d.c - Dissassembler to dissassemble the roms, use hexeditor for clarity
\end{itemize}
\section*{Main}
\begin{itemize}
	\item Work on keyboard input/interrupts and graphics working together
	\item work on main method class
\end{itemize}

\section*{Reference}
\begin{itemize}
	\item https://tobiasvl.github.io/blog/write-a-chip-8-emulator/
	\item http://devernay.free.fr/hacks/chip8/C8TECH10.HTM
\end{itemize}

\end{document}
